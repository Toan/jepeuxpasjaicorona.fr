<!doctype html>
<html>
<head>
    <!--
    Because ... we are unicorns
                  ,,))))))));,
           __)))))))))))))),
\|/       -\(((((''''((((((((.
-*-==//////((''  .     `)))))),
/|\      ))| o    ;-.    '(((((                                  ,(,
         ( `|    /  )    ;))))'                               ,_))^;(~
            |   |   |   ,))((((_     _____------~~~-.        %,;(;(>';'~
            o_);   ;    )))(((` ~---~  `::           \      %%~~)(v;(`('~
                  ;    ''''````         `:       `:::|\,__,%%    );`'; ~
                 |   _                )     /      `:|`----'     `-'
           ______/\/~    |                 /        /
         /~;;.____/;;'  /          ___--,-(   `;;;/
        / //  _;______;'------~~~~~    /;;/\    /
       //  | |                        / ;   \;;,\
      (<_  | ;                      /',/-----'  _>
       \_| ||_                     //~;~~~~~~~~~
           `\_|                   (,~~  -Tua Xiong
                                   \~\
                                    ~~
                                    -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="css/bootstrap.min.css" crossorigin="anonymous">
    <script src="js/popper.min.js" crossorigin="anonymous"></script>
    <script src="js/jquery-3.3.1.slim.min.js" crossorigin="anonymous"></script>
    <script src="js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script src="js/jspdf.min.js" crossorigin="anonymous"></script>
    <script src="js/signature_pad.min.js"></script>
    <script type="text/javascript" src="js/bootstrap-datepicker.min.js"></script>
    <link rel="stylesheet" href="css/bootstrap-datepicker3.css"/>

    <title>Générateur d'attestation COVID-19</title>

    <style>
        body { background-color: #fafafa; }
        #myCanvas {
            border:2px solid #444;
            border-radius: 15px;
            background-color: #fafafa;
        }
        .container { margin: 150px auto; }
    </style>
    <script>

        function gettime() {
            var time=new Date();

            var h=time.getHours();
            if (h<10) {h = "0" + h}
            var m=time.getMinutes();
            if (m<10) {m = "0" + m}

            $('#attheure').val(h);
            $('#attmn').val(m);
        }
        function generate_pdf() {
            var doc = new jsPDF();

            var gender = $('#gender').val();
            var name = $('#name').val();
            var birthday = $('#birthday').val();
            var address =  $('#address').val();
            var type =  $('#type').val();
            var lineheight = 7;
            var attdate = $('#attdate').val();
            var attville = $('#attville').val();
            var attcp = $('#attcp').val();
            var attheure = $('#attheure').val();
            var attmn = $('#attmn').val();
            var pos = 0;
            doc.setFont("arial");
            doc.setFontStyle("bold");
            doc.setFontSize(16);
            pos +=20;
            doc.text("ATTESTATION DE DÉPLACEMENT DÉROGATOIRE", 105, pos, null, null, "center");

            doc.setFontStyle("normal");
            doc.setFontSize(10);
            pos +=5;
            var header_text =  doc.splitTextToSize("En application de l’article 3 du décret du 23 mars 2020 prescrivant les mesures générales nécessaires pour faire face à l’épidémie de Covid19 dans le cadre de l’état d’urgence sanitaire", 180);
            doc.text(header_text, 105, pos, null, null, "center");

            doc.setFontSize(13);
            var intro_text = '';
            if (gender == 1) {
                intro_text = doc.splitTextToSize("Je soussignée Mme. "+name+" née le "+birthday+" et demeurant "+address+", "+attcp+", "+attville+".", 180);

            } else {
                intro_text = doc.splitTextToSize("Je soussigné M. "+name+" né le "+birthday+" et demeurant "+address+", "+attcp+", "+attville+".", 180);

            }
            pos +=50;

            doc.text(intro_text, 20, pos);
            pos +=(intro_text.length*lineheight);

            text2 = doc.splitTextToSize("certifie que mon déplacement est lié au motif suivant (cocher la case) autorisé par l’article 3 du décret du 23 mars 2020 prescrivant les mesures générales nécessaires pour faire face à l’épidémie de Covid19 dans le cadre de l’état d’urgence sanitaire :", 180);
            doc.text(text2, 20, pos);
            pos +=(text2.length*lineheight);

            if(type=='pro') {
                text3 = doc.splitTextToSize("Déplacements entre le domicile et le lieu d’exercice de l’activité professionnelle, lorsqu’ils sont indispensables à l’exercice d’activités ne pouvant être organisées sous forme de télétravail ou déplacements professionnels ne pouvant être différés.", 180);
            } else if(type=='miam') {
                text3 = doc.splitTextToSize("Déplacements pour effectuer des achats de fournitures nécessaires à l’activité professionnelle et des achats de première nécessité dans des établissements dont les activités demeurent autorisées (liste sur gouvernement.fr).", 180);
            } else if(type=='argh') {
                text3 = doc.splitTextToSize("Consultations et soins ne pouvant être assurés à distance et ne pouvant être différés ; consultations et soins des patients atteints d'une affection de longue durée.", 180);

            } else if(type=='famille') {
                text3 = doc.splitTextToSize("Déplacements pour motif familial impérieux, pour l’assistance aux personnes vulnérables ou la garde d’enfants.", 180);
            } else if(type=='footing!') {
                text3 = doc.splitTextToSize("Déplacements brefs, dans la limite d'une heure quotidienne et dans un rayon maximal d'un kilomètre autour du domicile, liés soit à l'activité physique individuelle des personnes, à l'exclusion de toute pratique sportive collective et de toute proximité avec d'autres personnes, soit à la promenade avec les seules personnes regroupées dans un même domicile, soit aux besoins des animaux de compagnie.", 180);
            } else if(type=='aieaieaie!') {
                text3 = doc.splitTextToSize("Convocation judiciaire ou administrative.", 180);
            } else if(type=='faitesunemissiondinteretgeneralmaissurtoutnesortezpas!') {
                text3 = doc.splitTextToSize("Participation à des missions d’intérêt général sur demande de l’autorité administrative.", 180);
            }
            doc.text(text3, 20, pos);
            pos +=(text2.length*lineheight)+21;
            doc.text("Fait à "+attville+" le "+attdate+" à "+attheure+"h"+attmn, 190, pos, null, null, "right");
            var canvas = document.getElementById("myCanvas");
            var imageURI = canvas.toDataURL("image/jpg");
            // $('#signimg').val(imageURI);
            pos += 7;
            doc.addImage(imageURI, "JPEG", 160, pos, 50, 37.5);
            doc.save('corona_attestation.pdf');
        }
    </script>
    <script>
        $(document).ready(function()
        {
            ;(function($){
            $.fn.datepicker.dates['fr'] = {
                days: ["dimanche", "lundi", "mardi", "mercredi", "jeudi", "vendredi", "samedi"],
                daysShort: ["dim.", "lun.", "mar.", "mer.", "jeu.", "ven.", "sam."],
                daysMin: ["d", "l", "ma", "me", "j", "v", "s"],
                months: ["janvier", "février", "mars", "avril", "mai", "juin", "juillet", "août", "septembre", "octobre", "novembre", "décembre"],
                monthsShort: ["janv.", "févr.", "mars", "avril", "mai", "juin", "juil.", "août", "sept.", "oct.", "nov.", "déc."],
                today: "Aujourd'hui",
                monthsTitle: "Mois",
                clear: "Effacer",
                weekStart: 1,
                format: "dd/mm/yyyy"
            };
        }(jQuery));

            var date_input=$('input[name="birthday"]');
            var container=$('.bootstrap-iso form').length>0 ? $('.bootstrap-iso form').parent() : "body";
            var options={
                format: 'dd/mm/yyyy',
                container: container,
                todayHighlight: true,
                autoclose: true,
                language: 'fr'
            };
            date_input.datepicker(options);
        });
    </script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-160964088-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-160964088-1');
    </script>
</head>
<body>
<div>Mise à jour avec la nouvelle version de l'attestation du 23 mars 2020.</div>
<br><br>
<h1>Générateur d'attestation COVID-19</h1>


Civilité : <select name="gender" id="gender" class="form-control">
    <option value="1">Mme.</option>
    <option value="2">M.</option>
</select><br />
Nom et Prénom : <input type="text" value="" name="name" id="name" class="form-control" required>
<br />
Date de naissance : <input type="text" value="" name="birthday" id="birthday" class="form-control">
<br />
Adresse : <input type="text" value="" name="address" id="address" class="form-control" required>
<br />
Code postal : <input type="text" value="" name="attcp" id="attcp" class="form-control">
<br />
Ville : <input type="text" value="" name="attville" id="attville" class="form-control">
<br />
Nature : <select name="type" id="type" class="form-control">
    <option value="pro">Professionnel</option>
    <option value="miam">Achats de première nécessité</option>
    <option value="argh">Santé</option>
    <option value="famille">Familiale/garde d'enfants</option>
    <option value="footing!">Sport individuel/animaux de compagnie</option>
    <option value="aieaieaie!">Convocation judiciaire ou administration</option>
    <option value="faitesunemissiondinteretgeneralmaissurtoutnesortezpas!">Missions d'intéret général sur demande des autorités</option>
</select><br />

Date de l'attestation : <input type="text" value="" name="attdate" id="attdate" class="form-control">
Heure de début de la sortie :
<div class="form-inline">
    <input type="text" value="" name="attheure" id="attheure" class="form-control">h<input type="text" value="" name="attmn" id="attmn" class="form-control">
</div>
<br />
Votre signature :

<br />
<div class="signature-pad--body">
    <canvas id="myCanvas"></canvas>
</div><br><br>
<input type="hidden" value="" id='signimg' name="signimg">

<input type="button" value="Effacer la signature" id="clearb" class="btn btn-danger">
<input type="button" value="Générer le PDF" onclick="generate_pdf();" class="btn btn-success">
<script>


    var canvas = document.querySelector("canvas");

    var signaturePad = new SignaturePad(canvas);
    $( "#attdate" ).datepicker({ format: "dd/mm/yyyy"}).datepicker("setDate",new Date());
    var clearButton = document.getElementById("clearb");
    clearButton.addEventListener("click", function (event) {
        signaturePad.clear();
    });
    gettime();
</script>
<br/>
<br/>
<br/>
Aucunes données ne sont enregistrées sur nos serveurs, la création du PDF est faites directement avec les données fournies (voir code source ^^), nous utilisons Google Analytics pour savoir quelle région en génèrent le plus (pour le moment c'est la régions parisienne ça va de soit)...<br />
Une nouvelle version vient d'être publiée, puisque certains pensent qu'il y a détournement de données, cette nouvelle version est full javascript, elle peut être télécharger sur Github <a href="https://github.com/Toan/jepeuxpasjaicorona.fr/archive/master.zip" target="_blank">Lien direct du telechargement</a> et executer directement en local en ouvrant index.html ! Have fun ;)<br /><br />
<a href="https://github.com/Toan/jepeuxpasjaicorona.fr" target="_blank">Code source sur github</a>
</body>
</html>
